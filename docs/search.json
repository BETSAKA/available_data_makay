[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Visualisation de données disponibles sur le Makay",
    "section": "",
    "text": "1 Introduction\nCe site de visualisation de données est réalisé dans le cadre du projet “Observatoire Makay-DT3Ma”. Il vise à fournir des éléments de contexte aux chercheuses et chercheurs qui travaillent sur la région, à partir de données librement accessibles.Voir le site dédié du projet Observartoire Makay-DT3Ma pour plus d’informations.\nIl s’agit notamment de nourrir l’articulation entre les bras socioéconomique, ethnoécologique et anthropologique de ce projet de recherche, en documentant à partir de sources tierces (satellitaires principalement) des évènements concrets susceptibles d’être appréhendées dans chacun des bras. On a ainsi identifié des passages de cyclones, feux de brousse/forêt et périodes de pluie/sécheresse. De par leur nature, ces évènements concrets sont circonscrits dans le temps et l’espace et documenter leur chronologie et leur localisation dans les enquêtes de chacun des bras favorisera l’étalonnage, la comparabilité et les échanges entre les bras. Concrètement, un feu de brousse de grande ampleur survenu dans une zone déterminée est susceptible d’influencer les résultats de l’enquête OR pour les localités avoisinantes (bras socioéconomique), les écosystèmes et leur perception par les populations locales (bras ethnoécologique), ou encore les représentations captées par le bras anthropologique.\nPar souci de transparence et pour être en mesure de reproduire les analyses plus tard, en actualisant ou non les données sources, on travaille avec le logiciel statistique R et le système de rendus quarto. Un seul document, archivé et versionné de manière rigoureuse, contient à la fois le texte d’analyse, les traitements de données (bloc de code ci-dessous) et les visualisations de résultats. L’ensemble du code source est accessible en cliquant sur l’icône en haut à gauche de l’écran.\n\n\nCode\n# # Le package est en cours de développement, toujours installer la version en cours\nif (!\"geoarrow-r\" %in% installed.packages()) {\nremotes::install_github(\"geoarrow/geoarrow-r\")  # to write/read efficient spatial vector format\n}\n\n\nnanoarrow (NA -&gt; 0.4.0.1) [CRAN]\n── R CMD build ─────────────────────────────────────────────────────────────────\n* checking for file ‘/tmp/RtmplJhdKX/remotes14ec6c561aff/geoarrow-geoarrow-r-7065a18/DESCRIPTION’ ... OK\n* preparing ‘geoarrow’:\n* checking DESCRIPTION meta-information ... OK\n* cleaning src\n* checking for LF line-endings in source and make files and shell scripts\n* checking for empty or unneeded directories\n* building ‘geoarrow_0.1.0.9000.tar.gz’\n\n\nCode\nlibrairies_requises &lt;- c( # On liste les librairies dont on a besoin\n  \"aws.s3\", # Pour lire-écrire des données cloud (datalake SSP Cloud)\n  \"tidyverse\", # toolkit for data manipulation\n  \"geodata\", # to get municipalities\n  \"sf\", # to handle spatial data (vectors)\n  \"terra\", # to handle patial data (rasters)\n  \"mapme.biodiversity\", # to compute spatial indicators\n  \"tmap\", # nice maps\n  \"zoo\", # time series\n  \"units\", # ensures units are right\n  \"future\", # to parallelize computations\n  \"exactextractr\", # engine for mapme.biodiversity\n  \"SPEI\") # to compute rainfall  \n\n# On regarde parmi ces librairies lesquelles ne sont pas installées\nmanquantes &lt;- !(librairies_requises %in% installed.packages())\n# On installe celles qui manquent\nif(any(manquantes)) install.packages(librairies_requises[manquantes])\n\n# Désactiver les notations scientifiques\noptions(scipen =999)\n\n\nLe rendu des données est réalisé à partir de la plateforme SSP Cloud mise à disposition par l’INSEE pour le service public.\nCrédit photo: Vue du Makay © Jean-Michel Wachsberger",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "01_carte_generale.html",
    "href": "01_carte_generale.html",
    "title": "2  Carte générale",
    "section": "",
    "text": "Code\nlibrary(tidyverse)\nlibrary(tmap)\nlibrary(sf)\nlibrary(units)\nlibrary(methods)\n\n\nmakay_ap &lt;- st_read(\"data/Makay_wgs84.geojson\", quiet = TRUE) %&gt;% \n  rename(Statut = SOURCETHM) %&gt;% \n  mutate(Statut = recode(Statut, \"zone tampon\" = \"Zone tampon\"))\n\n# Fist we dissolve the different areas\nmakay_union &lt;- makay_ap %&gt;% \n  st_union() %&gt;% \n  st_sf() %&gt;% \n  st_make_valid()\n\n# Define the buffer size (in kilometers) for the square expansion\nbuffer_size_km &lt;- 60\n\n# Create a 20km buffer around Makay PA\nmakay_buffer &lt;- makay_union %&gt;%\n  st_buffer(dist = set_units(buffer_size_km, km)) %&gt;%\n  st_as_sf()\n\n# Load population estimations\npop &lt;- read_csv(\"data/population/mdg_admpop_adm4_2018.csv\") %&gt;%\n  select(ADM4_PCODE, pop = T_TL)\n\n# Read administrative area boundaries\ncommunes &lt;- st_read(\n  \"data/OCHA_BNGRC admin boundaries/mdg_admbnda_adm3_BNGRC_OCHA_20181031.shp\",\n  quiet = TRUE) %&gt;% \n  st_make_valid()\nfokontany &lt;- st_read(\n  \"data/OCHA_BNGRC admin boundaries/mdg_admbnda_adm4_BNGRC_OCHA_20181031.shp\",\n  quiet = TRUE) %&gt;% \n  st_make_valid()\nplaces &lt;- st_read(\n  \"data/OCHA_BNGRC populated places/mdg_pplp_places_NGA_OCHA.shp\",\n  quiet = TRUE)\n\n# Crop communes and fokontany using the square buffer\ncropped_communes &lt;- communes %&gt;%\n  filter(st_intersects(., makay_buffer, sparse = FALSE))\ncropped_fokontany &lt;- fokontany %&gt;% \n  filter(ADM3_PCODE %in% cropped_communes$ADM3_PCODE) %&gt;% \n  left_join(pop, by = \"ADM4_PCODE\") %&gt;%\n  rename(Commune = ADM3_EN, Fokontany = ADM4_EN,\n         `Population 2018 (estimation)` = pop)\ncropped_places &lt;- places %&gt;% \n  mutate(ADM3_PCODE = str_replace(COM_PCODE, \"MDG\", \"MG\"),\n         FOKONTANY_DEB = str_remove(DISTRICT, \"Ville I\")) %&gt;%\n  filter(ADM3_PCODE %in% cropped_communes$ADM3_PCODE) %&gt;%\n  mutate(Chef_lieu = case_when(\n    str_starts(FOKONTANY, PLACE_NAME) & str_starts(FOKONTANY, DISTRICT) ~ \n      \"District\",\n    str_starts(FOKONTANY, PLACE_NAME)   & str_starts(FOKONTANY, COMMUNE) \n    ~ \"Commune\",\n    str_starts(FOKONTANY, PLACE_NAME)  ~ \"Fokontany\",\n    .default = \"\"),\n    Chef_lieu = factor(Chef_lieu, levels = c(\"\", \"Fokontany\", \n                                             \"Commune\", \"District\")),\n    size_dot = case_when(\n      Chef_lieu == \"\" ~ 0.001,\n      Chef_lieu == \"Fokontany\" ~ 0.002, \n      Chef_lieu == \"Commune\" ~ 0.005,\n      Chef_lieu == \"District\" ~ 0.007,\n      .default = 0.001))\n    \n\n# tm_shape(makay_ap, name = \"Zones de l'AP\") +\n#   tm_polygons(col = \"Statut\", alpha = 0.5) +\ntmap_mode(\"view\")\ntm_shape(cropped_places, name = \"Localités\") +\n  tm_dots(size = \"size_dot\", size.max = 0.05, col = \"Chef_lieu\",\n          palette = c(\"lightgrey\", \"grey\", \"darkgrey\", \"black\"),\n                      id = \"PLACE_NAME\",\n                      popup.vars = c(\"PLACE_NAME\",\n                                     \"FOKONTANY\",\n                                     \"COMMUNE\")) +\n  tm_shape(makay_union, name = \"Périmètre exterieur de l'AP\") +\n  tm_borders(col = \"darkgreen\", lwd = 2) + \n  tm_add_legend(type = \"fill\", col = \"darkgreen\", labels = \"AP Makay\") +\n  tm_shape(cropped_fokontany, name = \"Fokontany\") +\n  tm_borders(col = \"grey\") +\n  tm_fill(alpha = 0, id = \"Fokontany\",\n          popup.vars = c(\"Fokontany\",\n                         \"Population 2018 (estimation)\",\n                         \"Commune\")) +\n  tm_shape(cropped_communes, name = \"Communes\") +\n  tm_borders(col = \"black\")  +\n  tm_basemap(\"OpenStreetMap\") +\n  tm_view(dot.size.fixed = FALSE, set.view = 9)\n\n\n\n\n\nAP Makay (source: Bernard), carte administrative et projections de population (source: OCHA) et localités (source BNGRC)"
  },
  {
    "objectID": "02_climat.html",
    "href": "02_climat.html",
    "title": "3  Climat",
    "section": "",
    "text": "3.1 Pluviométrie\nCode\nlibrary(aws.s3)\nlibrary(tidyverse) # toolkit for data manipulation\nlibrary(geodata) # to get municipalities\nlibrary(sf) # to handle spatial data (vectors)\nlibrary(terra) # to handle patial data (rasters)\nlibrary(mapme.biodiversity) # to compute spatial indicators\nlibrary(tmap) # nice maps\nlibrary(zoo) # time series\nlibrary(units) # ensures units are right\nlibrary(future) # to parallelize computations\nlibrary(exactextractr) # engine for mapme.biodiversity\nlibrary(SPEI) # to compute rainfall",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Climat</span>"
    ]
  },
  {
    "objectID": "02_climat.html#précipitations",
    "href": "02_climat.html#précipitations",
    "title": "3  Climat",
    "section": "3.2 Précipitations",
    "text": "3.2 Précipitations\nNous utilisons les données CHIRPS de la NASA pour estimer la pluviométrie moyenne sur 3 jours dans la zone protégée de Makay. Les données sources ont une résolution spatiale de 0,05° (environ 5 km). Nous traitons les données à l’aide du package mapme.biodiversity (Görgen and Bhandari 2023).\n\n\nCode\nmakay_ap &lt;- st_read(\"data/Makay_wgs84.geojson\", quiet = TRUE) %&gt;% \n  rename(Statut = SOURCETHM) %&gt;% \n  mutate(Statut = recode(Statut, \"zone tampon\" = \"Zone tampon\"))\n\n# Fist we dissolve the different areas\nmakay_union &lt;- makay_ap %&gt;% \n  st_union() %&gt;% \n  st_sf() %&gt;% \n  st_make_valid()\n\n# We group Makay PA zones and communes to have an object with all areas of interest\n# We keep only one common field \"name\"\naoi &lt;- makay_union\n\n# we use parallel computing to reduce processing time\nplan(multisession, workers = 8)\n\n# Reference portfolio (chirps data was loaded at startup)\naoi &lt;- init_portfolio(aoi, years = 1990:2023,\n                      outdir = \"data\") \n\n\naoi_1 &lt;- s3read_using(FUN = read_rds, object = \"diffusion/makay/aoi_1.rds\",\n                      bucket = \"fbedecarrats\", opts = list(\"region\" = \"\"))\n\nif (!exists(\"aoi_1\")) {\n  aoi &lt;- aoi %&gt;%\n  get_resources(\"chirps\")\n  # Compute precipitation\n  aoi_1 &lt;- aoi %&gt;%\n    calc_indicators(\"precipitation_chirps\",\n                    engine = \"exactextract\",\n                    scales_spi = 3,\n                    spi_prev_years = 8)\n  s3write_using(aoi_1, FUN = write_rds, object = \"diffusion/makay/aoi_1.rds\",\n                bucket = \"fbedecarrats\", opts = list(\"region\" = \"\"))\n}\n\n# We compute 3d average precipitations\nprecip_3d &lt;- aoi_1 %&gt;%\n  unnest(precipitation_chirps) %&gt;%\n  group_by(name) %&gt;%\n  mutate(rainfall_3d_mean = rollmean(absolute, k = 3, fill = NA))\n\n# We display precipitations for Makay area\nprecip_3d %&gt;%\n  filter(name == \"AP Makay : Ensemble\") %&gt;%\n  ggplot(aes(x = dates, y = rainfall_3d_mean)) +\n  geom_line()\n\n\n\n\n\nPrécipitations sur l’AP Makay (source : CHIRPS, moyenne mobile sur 3 jours)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Climat</span>"
    ]
  },
  {
    "objectID": "02_climat.html#cyclones",
    "href": "02_climat.html#cyclones",
    "title": "3  Climat",
    "section": "3.3 Cyclones",
    "text": "3.3 Cyclones\nNous utilisons les données de suivu du climat IBTrACS pour obtenir l’historique des trajectoires des cyclones et les attributs des cyclones (Knapp et al. 2010). Cette procédure est fortement inspirée du code source de mapme.protectedareas (Schielein 2023).\n\n\nCode\nif (!file.exists(\"data/ibtracs/IBTrACS.since1980.list.v04r00.lines.shp\")) {\n  dir.create(\"data/ibtracs\")\n  download.file(url = \"https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/v04r00/access/shapefile/IBTrACS.since1980.list.v04r00.lines.zip\", \n                destfile = \"data/ibtracs/ibtracs_lines.zip\")\n  unzip(\"data/ibtracs/ibtracs_lines.zip\", exdir = \"data/ibtracs\")\n}\n\nmada &lt;- gadm(\"MDG\", level=0, path = \"data\") %&gt;%\n  st_as_sf()\n\n# column description is given here: https://www.ncei.noaa.gov/sites/default/files/2021-07/IBTrACS_v04_column_documentation.pdf\ncyclones &lt;- read_sf(\"data/ibtracs/IBTrACS.since1980.list.v04r00.lines.shp\")\n\n# Create a buffer 300km around Madagascar\nmada_buff &lt;- st_buffer(mada, 300)\n\ncyclones$wind_combined &lt;- cyclones %&gt;%\n  select(contains(\"WIND\")) %&gt;%\n  select(-WMO_WIND) %&gt;%\n  st_drop_geometry() %&gt;%\n  rowMeans(., na.rm = T)\n\ncyclones_mada &lt;- cyclones %&gt;%\n  st_intersection(mada_buff) %&gt;%\n  select(Season = SEASON, Name = NAME, Winds_in_knots = wind_combined)\n\ntmap_mode(\"view\")\ntm_shape(makay_union) + \n  tm_borders(col = \"darkblue\") + \n  tm_shape(cyclones_mada) +\n  tm_lines(col = \"Season\", lwd = \"Winds_in_knots\", scale = 3, palette = \"Blues\",\n           popup.vars = c(\"Name\", \"Season\", \"Winds in knots\" = \"Winds_in_knots\"),\n           legend.format = list(big.mark=\"\"), popup.format = list(big.mark=\"\"))",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Climat</span>"
    ]
  }
]