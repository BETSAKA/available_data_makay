[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Visualisation de données disponibles sur le Makay",
    "section": "",
    "text": "1 Introduction\nCe site de visualisation de données est réalisé dans le cadre du projet “Observatoire Makay-DT3Ma”. Il vise à fournir des éléments de contexte aux chercheuses et chercheurs qui travaillent sur la région, à partir de données librement accessibles.Voir le site dédié du projet Observartoire Makay-DT3Ma pour plus d’informations.\nIl s’agit notamment de nourrir l’articulation entre les bras socioéconomique, ethnoécologique et anthropologique de ce projet de recherche, en documentant à partir de sources tierces (satellitaires principalement) des évènements concrets susceptibles d’être appréhendées dans chacun des bras. On a ainsi identifié des passages de cyclones, feux de brousse/forêt et périodes de pluie/sécheresse. De par leur nature, ces évènements concrets sont circonscrits dans le temps et l’espace et documenter leur chronologie et leur localisation dans les enquêtes de chacun des bras favorisera l’étalonnage, la comparabilité et les échanges entre les bras. Concrètement, un feu de brousse de grande ampleur survenu dans une zone déterminée est susceptible d’influencer les résultats de l’enquête OR pour les localités avoisinantes (bras socioéconomique), les écosystèmes et leur perception par les populations locales (bras ethnoécologique), ou encore les représentations captées par le bras anthropologique.\nPar souci de transparence et pour être en mesure de reproduire les analyses plus tard, en actualisant ou non les données sources, on travaille avec le logiciel statistique R et le système de rendus quarto. Un seul document, archivé et versionné de manière rigoureuse, contient à la fois le texte d’analyse, les traitements de données (bloc de code ci-dessous) et les visualisations de résultats. L’ensemble du code source est accessible en cliquant sur l’icône en haut à gauche de l’écran.\n\n\nCode\nlibrairies_requises &lt;- c( # On liste les librairies dont on a besoin\n  \"aws.s3\", # Pour lire-écrire des données cloud (datalake SSP Cloud)\n  \"tidyverse\", # toolkit for data manipulation\n  \"geodata\", # to get municipalities\n  \"sf\", # to handle spatial data (vectors)\n  \"terra\", # to handle patial data (rasters)\n  \"mapme.biodiversity\", # to compute spatial indicators\n  \"tmap\", # nice maps\n  \"zoo\", # time series\n  \"units\", # ensures units are right\n  \"future\", # to parallelize computations\n  \"exactextractr\", # engine for mapme.biodiversity\n  \"SPEI\") # to compute rainfall  \n\n# On regarde parmi ces librairies lesquelles ne sont pas installées\nmanquantes &lt;- !(librairies_requises %in% installed.packages())\n# On installe celles qui manquent\nif(any(manquantes)) install.packages(librairies_requises[manquantes])\n\n# Désactiver les notations scientifiques\noptions(scipen =999)\n\n\nLe rendu des données est réalisé à partir de la plateforme SSP Cloud mise à disposition par l’INSEE pour le service public.\nCrédit photo: Vue du Makay © Jean-Michel Wachsberger"
  },
  {
    "objectID": "02_climat.html",
    "href": "02_climat.html",
    "title": "3  Climat",
    "section": "",
    "text": "3.1 Précipitations\nNous utilisons les données CHIRPS de la NASA pour estimer la pluviométrie moyenne sur 3 jours dans la zone protégée de Makay. Les données sources ont une résolution spatiale de 0,05° (environ 5 km). Nous traitons les données à l’aide du package mapme.biodiversity (Görgen and Bhandari 2023).\nCode\nlibrary(aws.s3)\nlibrary(tidyverse) # toolkit for data manipulation\nlibrary(geodata) # to get municipalities\nlibrary(sf) # to handle spatial data (vectors)\nlibrary(terra) # to handle patial data (rasters)\nlibrary(mapme.biodiversity) # to compute spatial indicators\nlibrary(tmap) # nice maps\nlibrary(zoo) # time series\nlibrary(units) # ensures units are right\nlibrary(future) # to parallelize computations\nlibrary(exactextractr) # engine for mapme.biodiversity\nlibrary(SPEI) # to compute rainfall  \n\nmakay_ap &lt;- st_read(\"data/Makay_wgs84.geojson\", quiet = TRUE) %&gt;% \n  rename(Statut = SOURCETHM) %&gt;% \n  mutate(Statut = recode(Statut, \"zone tampon\" = \"Zone tampon\"))\n\n# Fist we dissolve the different areas\nmakay_union &lt;- makay_ap %&gt;% \n  st_union() %&gt;% \n  st_sf() %&gt;% \n  st_make_valid()\n\n# We group Makay PA zones and communes to have an object with all areas of interest\n# We keep only one common field \"name\"\naoi &lt;- makay_union\n\n# we use parallel computing to reduce processing time\nplan(multisession, workers = 8)\n\n# Reference portfolio (chirps data was loaded at startup)\naoi &lt;- init_portfolio(aoi, years = 1990:2023,\n                      outdir = \"data\") \n\n\naoi_1 &lt;- s3read_using(FUN = read_rds, object = \"diffusion/makay/aoi_1.rds\",\n                      bucket = \"fbedecarrats\", opts = list(\"region\" = \"\"))\n\nif (!exists(\"aoi_1\")) {\n  aoi &lt;- aoi %&gt;%\n  get_resources(\"chirps\")\n  # Compute precipitation\n  aoi_1 &lt;- aoi %&gt;%\n    calc_indicators(\"precipitation_chirps\",\n                    engine = \"exactextract\",\n                    scales_spi = 3,\n                    spi_prev_years = 8)\n  s3write_using(aoi_1, FUN = write_rds, object = \"diffusion/makay/aoi_1.rds\",\n                bucket = \"fbedecarrats\", opts = list(\"region\" = \"\"))\n}\n\n# We compute 3d average precipitations\nprecip_3d &lt;- aoi_1 %&gt;%\n  unnest(precipitation_chirps) %&gt;%\n  group_by(name) %&gt;%\n  mutate(rainfall_3d_mean = rollmean(absolute, k = 3, fill = NA))\n\n# We display precipitations for Makay area\nprecip_3d %&gt;%\n  filter(name == \"AP Makay : Ensemble\") %&gt;%\n  ggplot(aes(x = dates, y = rainfall_3d_mean)) +\n  geom_line()\n\n\n\n\n\nPrécipitations sur l’AP Makay (source : CHIRPS, moyenne mobile sur 3 jours)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Climat</span>"
    ]
  },
  {
    "objectID": "02_climat.html#cyclones",
    "href": "02_climat.html#cyclones",
    "title": "3  Climat",
    "section": "3.2 Cyclones",
    "text": "3.2 Cyclones\nNous utilisons les données de suivu du climat IBTrACS pour obtenir l’historique des trajectoires des cyclones et les attributs des cyclones (Knapp et al. 2010). Cette procédure est fortement inspirée du code source de mapme.protectedareas (Schielein 2023).\n\n\nCode\nif (!file.exists(\"data/ibtracs/IBTrACS.since1980.list.v04r00.lines.shp\")) {\n  dir.create(\"data/ibtracs\")\n  download.file(url = \"https://www.ncei.noaa.gov/data/international-best-track-archive-for-climate-stewardship-ibtracs/v04r00/access/shapefile/IBTrACS.since1980.list.v04r00.lines.zip\", \n                destfile = \"data/ibtracs/ibtracs_lines.zip\")\n  unzip(\"data/ibtracs/ibtracs_lines.zip\", exdir = \"data/ibtracs\")\n}\n\nmada &lt;- gadm(\"MDG\", level=0, path = \"data\") %&gt;%\n  st_as_sf()\n\n# column description is given here: https://www.ncei.noaa.gov/sites/default/files/2021-07/IBTrACS_v04_column_documentation.pdf\ncyclones &lt;- read_sf(\"data/ibtracs/IBTrACS.since1980.list.v04r00.lines.shp\")\n\n# Create a buffer 300km around Madagascar\nmada_buff &lt;- st_buffer(mada, 300)\n\ncyclones$wind_combined &lt;- cyclones %&gt;%\n  select(contains(\"WIND\")) %&gt;%\n  select(-WMO_WIND) %&gt;%\n  st_drop_geometry() %&gt;%\n  rowMeans(., na.rm = T)\n\ncyclones_mada &lt;- cyclones %&gt;%\n  st_intersection(mada_buff) %&gt;%\n  select(Season = SEASON, Name = NAME, Winds_in_knots = wind_combined)\n\ntmap_mode(\"view\")\ntm_shape(makay_union) + \n  tm_borders(col = \"darkgreen\") + \n  tm_shape(cyclones_mada) +\n  tm_lines(col = \"Season\", lwd = \"Winds_in_knots\", scale = 3, palette = \"Blues\",\n           popup.vars = c(\"Name\", \"Season\", \"Winds in knots\" = \"Winds_in_knots\"),\n           legend.format = list(big.mark=\"\"), popup.format = list(big.mark=\"\"))",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Climat</span>"
    ]
  },
  {
    "objectID": "03_feux.html#feux-au-cours-de-lannée-écoulée",
    "href": "03_feux.html#feux-au-cours-de-lannée-écoulée",
    "title": "4  Feux",
    "section": "4.1 Feux au cours de l’année écoulée",
    "text": "4.1 Feux au cours de l’année écoulée\nPour cette visualisation, nous avons mobilisé des données provenant du satellite VIIRS (Visible Infrared Imaging Radiometer Suite). Les données téléchargées depuis le service FIRMS de la NASA portent uniquement sur les douze derniers mois. Elles incluent plusieurs variables, parmi lesquelles nous utilisons principalement la variable ‘frp’ (Fire Radiative Power) pour représenter l’intensité des incendies. Cette variable, exprimée en mégawatts (MW), quantifie le taux d’émission radiative des feux actifs, offrant une indication directe de l’intensité du feu. De plus, nous avons défini une zone d’intérêt de 20km autour de l’aire protégée et nous visualisons les données à l’intérieur de cette zone. La carte finale montre ces incendies avec une gradation de couleurs pour refléter l’intensité de chaque incendie.En cliquant sur les points, on peut consulter la date à laquelle le foyer a été enregistré par le satellite, ainsi que la probabilité qu’il s’agisse téellement d’un feu (classé en “élevée”, “nominale” et “faible”).\n\n\nCode\n# Ci-dessous les librairies R utilisées pour cette analyse\nlibrary(tidyverse) # pour la manipulation et visualisation de données\nlibrary(sf) # pour traiter les données spatiales\nlibrary(tmap) # pour générer des cartes\nlibrary(aws.s3) # Pour accéder aux données volumineuses stockées en ligne\nlibrary(geodata) # Pour avoir les frontières administratives\nlibrary(curl) # Pour télécharge\nlibrary(lubridate) # Pour manipuler des dates\nlibrary(httr)\nlibrary(mapme.biodiversity)\nlibrary(units)\n\n\n\n\nCode\n# Create a dataframe of the coordinates\ncoordinates &lt;- data.frame(\n  location = c(\"Beroroha\", \"Beronono\", \"Tsivoko\", \"Makaykely\"),\n  latitude = c(\"21°40.504’S\", \"21°21.669’S\", \"21°17.712’S\", \"21°28.074’S\"),\n  longitude = c(\"45°9.571’E\", \"45°14.885’E\", \"45°22.732’E\", \"45°21.896’E\")\n)\n\n# Function to parse DMS and convert to decimal degrees\nddm_to_decimal &lt;- function(dms){\n  # Extraire les degrés, minutes et secondes\n  parts &lt;- regmatches(dms, gregexpr(\"[0-9.]+\", dms))[[1]]\n  degree &lt;- as.numeric(parts[1])\n  minute &lt;- as.numeric(parts[2]) / 60\n  direction &lt;- ifelse(grepl(\"S|W\", dms), -1, 1)\n  \n  # Converstion au format décimal\n  decimal &lt;- direction * (degree + minute)\n  \n  return(decimal)\n}\n\n# Apply function to each coordinate\ncoordinates$latitude_decimal &lt;- sapply(coordinates$latitude, ddm_to_decimal)\ncoordinates$longitude_decimal &lt;- sapply(coordinates$longitude, ddm_to_decimal)\n\n# Convertir les coordonnées en objet sf\ncoordinates_sf &lt;- st_as_sf(coordinates, \n                           coords = c(\"longitude_decimal\", \"latitude_decimal\"), \n                           crs = 4326)\n\n\nmakay_ap &lt;- st_read(\"data/Makay_wgs84.geojson\", quiet = TRUE) %&gt;%\n  rename(Statut = SOURCETHM) %&gt;%\n  mutate(Statut = recode(Statut, \"zone tampon\" = \"Zone tampon\"))\n\n# Fusion des différentes aires\nmakay_union &lt;- makay_ap %&gt;%\n  st_union() %&gt;%\n  st_sf() %&gt;%\n  st_make_valid()\n\n# Define the buffer size (in kilometers) for the square expansion\nbuffer_size_km &lt;- 20\n\n# Create a 20km buffer around Makay PA\nmakay_buffer &lt;- makay_union %&gt;%\n  st_buffer(dist = set_units(buffer_size_km, km)) %&gt;%\n  st_as_sf()\n\n# Manual request at https://firms.modaps.eosdis.nasa.gov/download/create.php\n# Uses the following coordinates : 44.4,-22.4,46.4,-19.9\n# For VIIRS NOAA-20\nfirms_focus &lt;- read_csv(\"firms_manual.csv\") %&gt;%\n  st_as_sf(coords = c(\"longitude\", \"latitude\"), crs = 4326) %&gt;%\n  filter(lengths(st_within(., makay_buffer)) &gt; 0)\n\n\nbreaks_frp &lt;- c(min(firms_focus$frp), \n                median(firms_focus$frp), \n                max(firms_focus$frp))\nbreaks_frp_5 &lt;- quantile(firms_focus$frp, probs = seq(0, 1, by = 0.25), \n                         na.rm = TRUE)\ntmap_mode(\"view\")\ntm_shape(firms_focus) +\n  tm_dots(col = \"frp\", size = 0.2, alpha = 0.2,\n          palette = c(\"blue\", \"cyan\", \"yellow\", \"orange\", \"red\"),\n          border.col = NULL, breaks = breaks_frp_5,\n          popup.vars = c(\"acq_date\", \"confidence\", \"frp\"),\n          title = \"Fire radiative power\") +\n  tm_layout(title = \"Feux détectés autour du Malay\") +\n  tm_shape(makay_union) +\n  tm_borders(col = \"darkblue\") + \n  tm_shape(coordinates_sf) +\n  tm_dots(col = \"black\", size = 0.1, labels = coordinates_sf$location) +\n  tm_view(set.view = 10) +\n  tm_text(text = \"location\", ymod = -0.5) +\n  tm_basemap(\"OpenStreetMap\") +\n  tm_scale_bar()"
  },
  {
    "objectID": "03_feux.html#feux-détectés-sur-deux-décennies",
    "href": "03_feux.html#feux-détectés-sur-deux-décennies",
    "title": "4  Feux",
    "section": "4.2 Feux détectés sur deux décennies",
    "text": "4.2 Feux détectés sur deux décennies\nCes données s’appuient sur les données MODIS qui sont moins précises mais couvrent une période plus longue. On compare le Makay avec une zone périphérique de 60km. This analysis is based on the example produced by Darius Goergen on the Mapme website.\n\n\nCode\nif (!file.exists(\"nasa_firms.rds\")) {\n  \n  buff_size &lt;- 20\n  # Create a 20km buffer around Makay PA\n  makay_ext_buffer &lt;- makay_union %&gt;%\n    st_buffer(dist = set_units(buff_size, km)) %&gt;%\n    st_as_sf() %&gt;%\n    st_difference(makay_union)\n  \n  aoi &lt;- makay_union %&gt;%\n    bind_rows(makay_ext_buffer) %&gt;% \n    st_cast(\"POLYGON\") %&gt;%\n    mutate(name = c(\"Makay\", \"Périphérie 20km\"))\n  \n  aoi &lt;- init_portfolio(aoi, years = 1990:2022,\n                        outdir = \"data\") \n  \n  aoi &lt;- get_resources(aoi, \"nasa_firms\", instrument = \"MODIS\")\n  \n  gpkgs &lt;- list.files(file.path(\"data\", \"nasa_firms\"),\n                      pattern = \".gpkg\", full.names = TRUE)\n  nasa_firms &lt;- map_dfr(gpkgs, function(x) {\n    read_sf(x, wkt_filter = st_as_text(st_as_sfc(st_bbox(aoi))))\n  })\n  nasa_firms &lt;- nasa_firms[unlist(st_contains(aoi, nasa_firms)), ]\n  nasa_firms &lt;- filter(nasa_firms, confidence &gt; 50)\n  nasa_firms$year &lt;- as.factor(year(nasa_firms$acq_date))\n  # Remove year 2000 for visibility\n  nasa_firms &lt;- filter(nasa_firms, year != \"2000\" & year != \"2001\")\n  write_rds(nasa_firms, \"nasa_firms.rds\")\n} else  {\n  nasa_firms &lt;- read_rds(\"nasa_firms.rds\")\n}\n\ntmap_mode(\"plot\")\n\ntm_shape(nasa_firms) +\n  tm_dots(col = \"darkorange\", alpha = 0.1) + \n  tm_facets(by = \"year\", nrow = 6, ncol = 4) +\n  tm_shape(makay_union) + \n  tm_borders(col = \"darkblue\")\n\n\n\n\n\nFires in and around Makay PA (source: MODIS)\n\n\n\n\nCompute indicators on fires.\n\n\nCode\nif (!file.exists(\"fires.rds\"))  {\n  aoi &lt;- aoi %&gt;%\n    calc_indicators(\"active_fire_counts\")\n  \n  fires &lt;- aoi %&gt;%\n    unnest(active_fire_counts)\n  write_rds(fires, \"fires.rds\")\n} else  {\n  fires &lt;- read_rds(\"fires.rds\")\n}\n\nfires %&gt;%\n  ggplot(aes(x = year, y = active_fire_counts, group = name, color = name)) + \n  geom_line()\n\n\n\n\n\nFire occurence count in Makay PA (source: MODIS)\n\n\n\n\nCode\n# area_makay &lt;- st_area(makay_union) %&gt;%\n#   set_units(\"km2\")\n# area_buffer &lt;- st_area(makay_ext_buffer) %&gt;%\n#   set_units(\"km2\")\n\n\nLes différents ordres de grandeur doivent être interprétés avec précaution car la zone périphérique est plus de deux fois plus vaste que l’aire protégée (3,751 km2 contre 8,249 km2)."
  }
]